# 🏗️ Архитектура приложения

## Диаграмма потока данных

```
┌─────────────────────────────────────────────────────────────────────┐
│                        БРАУЗЕР / ПОЛЬЗОВАТЕЛЬ                       │
└─────────────────────────────────────┬───────────────────────────────┘
                                       │
                    ┌──────────────────▼──────────────────┐
                    │      Vue 3 App Instance             │
                    │     (src/main.js)                   │
                    └──────────────────┬──────────────────┘
                                       │
        ┌──────────────────────────────┼──────────────────────────────┐
        │                              │                              │
        ▼                              ▼                              ▼
    ┌─────────────┐            ┌──────────────┐            ┌──────────────┐
    │   Router    │            │   App.vue    │            │  CSS Styles  │
    │  (router.js)│            │ (навигация)  │            │(style.css)   │
    └─────────────┘            └──────────────┘            └──────────────┘
        │                              │
        │         ┌────────────────────┴────────────────────┐
        │         │                                         │
        ▼         ▼                                         ▼
    ┌─────────────────────┐                        ┌──────────────────┐
    │  Login.vue          │                        │  Register.vue    │
    │ (форма входа)       │◄──────────────────────►│(форма регистра)  │
    └──────┬──────────────┘                        └────────┬─────────┘
           │                                                │
           │                ┌───────────────────────────────┘
           │                │
           └────────┬───────┘
                    │
       ┌────────────▼──────────────┐
       │   Store (store.js)        │
       │  ┌────────────────────┐   │
       │  │ State:             │   │
       │  │ - user             │   │
       │  │ - authToken        │   │
       │  │ - isLoading        │   │
       │  │ - error            │   │
       │  └────────────────────┘   │
       │  ┌────────────────────┐   │
       │  │ Getters:           │   │
       │  │ - isAuthenticated  │   │
       │  │ - userRole         │   │
       │  │ - userId           │   │
       │  └────────────────────┘   │
       │  ┌────────────────────┐   │
       │  │ Actions:           │   │
       │  │ - register()       │   │
       │  │ - login()          │   │
       │  │ - logout()         │   │
       │  │ - setUser()        │   │
       │  └────────────────────┘   │
       └────────────────────────────┘
                    │
                    │ (использует)
                    │
       ┌────────────▼──────────────┐
       │   API Service (api.js)    │
       │ ┌───────────────────────┐ │
       │ │ authService:          │ │
       │ │ - register()          │ │
       │ │ - login()             │ │
       │ │ - logout()            │ │
       │ │ - getToken()          │ │
       │ │ - isAuthenticated()   │ │
       │ └───────────────────────┘ │
       │ ┌───────────────────────┐ │
       │ │ userService:          │ │
       │ │ - getProfile()        │ │
       │ │ - updateProfile()     │ │
       │ │ - searchByEmail()     │ │
       │ │ - linkGitHub()        │ │
       │ └───────────────────────┘ │
       │ ┌───────────────────────┐ │
       │ │ projectService:       │ │
       │ │ - getProjects()       │ │
       │ │ - createProject()     │ │
       │ │ - updateProject()     │ │
       │ │ - uploadFile()        │ │
       │ └───────────────────────┘ │
       │ ┌───────────────────────┐ │
       │ │ apiCall() - базовая   │ │
       │ │ функция для всех      │ │
       │ │ запросов (DRY)        │ │
       │ └───────────────────────┘ │
       └────────────────────────────┘
                    │
                    │ (использует)
                    │
       ┌────────────▼──────────────┐
       │  Config (config.js)       │
       │ ┌───────────────────────┐ │
       │ │ apiBaseUrl:           │ │
       │ │ - dev: localhost:3000 │ │
       │ │ - prod: api.example.. │ │
       │ │ endpoints: {...}      │ │
       │ └───────────────────────┘ │
       └────────────────────────────┘
                    │
                    │ (отправляет HTTP)
                    │
       ┌────────────▼──────────────┐
       │  LocalStorage            │
       │ ┌───────────────────────┐ │
       │ │ authToken             │ │
       │ │ user                  │ │
       │ └───────────────────────┘ │
       └────────────────────────────┘
                    │
                    │ (отправляет запросы)
                    │
       ┌────────────▼──────────────┐
       │  BACKEND API             │
       │  (http://localhost:3000)  │
       │ ┌───────────────────────┐ │
       │ │ POST /auth/register   │ │
       │ │ POST /auth/login      │ │
       │ │ GET /users            │ │
       │ │ POST /projects        │ │
       │ │ ...                   │ │
       │ └───────────────────────┘ │
       └────────────────────────────┘
                    │
                    │ (возвращает JSON)
                    │
       ┌────────────▼──────────────┐
       │  PostgreSQL Database      │
       │ (на backend)              │
       └────────────────────────────┘
```

## Поток аутентификации

```
┌────────────────────────────────────────────────────────────────┐
│ 1. Пользователь открывает http://localhost:5173               │
└────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌────────────────────────────────────────────────────────────────┐
│ 2. Vue загружает состояние из localStorage                      │
│    (если есть токен и пользователь)                             │
└────────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
           Токен есть?            Нет токена
                    │                   │
                    ▼                   ▼
        ┌───────────────────┐  ┌─────────────────┐
        │ Перейти на /      │  │ Перейти на      │
        │ (главная страница)│  │ /login          │
        └───────────────────┘  └────────┬────────┘
                                        │
                    ┌───────────────────┼───────────────────┐
                    │                   │                   │
                    ▼                   ▼                   ▼
            ┌──────────────┐   ┌──────────────┐   ┌──────────────┐
            │ /login       │   │ /register    │   │ Еще маршруты │
            │ (форма входа)│   │ (регистр.)   │   │              │
            └──────┬───────┘   └──────┬───────┘   └──────────────┘
                   │                  │
                   │                  │
        ┌──────────▼──┐     ┌────────▼──────┐
        │ Заполнить   │     │ Заполнить     │
        │ email       │     │ name          │
        │ password    │     │ email         │
        └──────┬──────┘     │ password      │
               │            │ password(2)   │
               │            │ schoolId?     │
        ┌──────▼──────┐     └────────┬──────┘
        │ Нажать      │              │
        │ "Войти"     │     ┌────────▼──────┐
        └──────┬──────┘     │ Нажать        │
               │            │ "Регистрац."  │
               │            └────────┬──────┘
               │                     │
        ┌──────┴─────────────────────┴──────┐
        │                                   │
        ▼                                   ▼
┌──────────────────────┐         ┌──────────────────────┐
│ POST /auth/login     │         │ POST /auth/register  │
│ { email, password }  │         │ { name, email, ... } │
└──────────┬───────────┘         └──────────┬───────────┘
           │                                │
           └────────────────┬───────────────┘
                            │
                    ┌───────▼────────┐
                    │ Backend        │
                    │ обрабатывает   │
                    │ запрос         │
                    └───────┬────────┘
                            │
              ┌─────────────┴──────────────┐
              │                            │
          Успех                        Ошибка
              │                            │
              ▼                            ▼
    ┌──────────────────┐       ┌──────────────────┐
    │ Возвращает:      │       │ Возвращает:      │
    │ {                │       │ {                │
    │   token: "...",  │       │   status: 401,   │
    │   user: { ... }  │       │   message: "..." │
    │ }                │       │ }                │
    └────────┬─────────┘       └────────┬─────────┘
             │                         │
    ┌────────▼──────────┐     ┌────────▼─────────┐
    │ Сохранить токен   │     │ Показать ошибку  │
    │ в localStorage    │     │ пользователю     │
    │                   │     │ (красное сообщ.) │
    │ Сохранить user    │     └──────────────────┘
    │ в state           │
    └────────┬──────────┘
             │
    ┌────────▼──────────┐
    │ Перенаправить на  │
    │ главную страницу  │
    │ /                 │
    └────────┬──────────┘
             │
    ┌────────▼──────────┐
    │ Выводить navbar   │
    │ с информацией о   │
    │ пользователе      │
    └───────────────────┘
```

## Структура компонентов

```
App.vue (главный компонент)
├── Navbar (навигационная панель, если авторизован)
└── router-view
    ├── /login → Login.vue
    │   └── useAuth() (hook для входа)
    ├── /register → Register.vue
    │   └── useAuth() (hook для регистрации)
    └── / (и другие маршруты)
        └── (другие компоненты)
```

## Слои приложения

```
┌─────────────────────────────────────────────────┐
│         СЛОЙ ПРЕДСТАВЛЕНИЯ (Views)               │
│  - Login.vue (форма входа)                       │
│  - Register.vue (форма регистрации)              │
│  - App.vue (главный компонент)                   │
└─────────────────────────────────────────────────┘
                        │
                        │ использует
                        ▼
┌─────────────────────────────────────────────────┐
│    СЛОЙ УПРАВЛЕНИЯ СОСТОЯНИЕМ (Store)            │
│  - store.js (управление состоянием пользователя) │
│  - useAuth() (composable hook)                   │
└─────────────────────────────────────────────────┘
                        │
                        │ использует
                        ▼
┌─────────────────────────────────────────────────┐
│      СЛОЙ СЕРВИСА (API Service)                  │
│  - authService (вход, выход, регистрация)       │
│  - userService (операции с пользователем)       │
│  - projectService (операции с проектами)        │
│  - apiCall() (базовая функция для всех запросов)│
└─────────────────────────────────────────────────┘
                        │
                        │ использует
                        ▼
┌─────────────────────────────────────────────────┐
│    СЛОЙ КОНФИГУРАЦИИ (Config)                    │
│  - config.js (URLs, endpoints)                   │
│  - .env (переменные окружения)                   │
└─────────────────────────────────────────────────┘
                        │
                        │ отправляет HTTP
                        ▼
┌─────────────────────────────────────────────────┐
│        BACKEND API & DATABASE                    │
│  - Express.js приложение на localhost:3000       │
│  - PostgreSQL база данных                       │
└─────────────────────────────────────────────────┘
```

## Управление состоянием

```
┌───────────────────────────────────────────────────────┐
│              РЕАКТИВНОЕ СОСТОЯНИЕ                      │
│  ┌─────────────────────────────────────────────────┐  │
│  │ state = reactive({                              │  │
│  │   user: null,                                   │  │
│  │   authToken: null,                              │  │
│  │   isLoading: false,                             │  │
│  │   error: null                                   │  │
│  │ })                                              │  │
│  └─────────────────────────────────────────────────┘  │
│                     │                                  │
│      ┌──────────────┼──────────────┐                  │
│      │              │              │                  │
│      ▼              ▼              ▼                  │
│  ┌─────────┐  ┌──────────┐  ┌──────────────┐         │
│  │Getters  │  │Mutations │  │  Actions     │         │
│  │─────────│  │──────────│  │──────────────│         │
│  │isAuth() │  │setUser() │  │register()    │         │
│  │role()   │  │setToken()│  │login()       │         │
│  │userId() │  │setError()│  │logout()      │         │
│  └─────────┘  │logout()  │  │setError()    │         │
│               │clearErr()│  │clearError()  │         │
│               └──────────┘  └──────────────┘         │
└───────────────────────────────────────────────────────┘
                     │
                     │ сохраняется в
                     ▼
┌───────────────────────────────────────────────────────┐
│             localStorage                              │
│  - authToken (JWT токен)                              │
│  - user (данные пользователя)                         │
└───────────────────────────────────────────────────────┘
```

## DRY принципы в действии

```
ДО (с дублированием):
─────────────────────────────────────────
Login.vue: fetch('/auth/login', {...})
Register.vue: fetch('/auth/register', {...})
Profile.vue: fetch('/users/1', {...})
Projects.vue: fetch('/projects', {...})
... каждый раз копируем обработку ошибок,
... токенов, headers и т.д.

ПОСЛЕ (с DRY):
─────────────────────────────────────────
Все компоненты используют:
- authService.login()
- authService.register()
- userService.getProfile()
- projectService.getProjects()

Которые используют одну функцию:
- apiCall() для всех HTTP запросов

✅ Результат:
- 100+ строк кода сокращены до 10-20
- Изменения в одном месте (apiCall)
- Консистентная обработка ошибок
- Легче тестировать и поддерживать
```

---

**Архитектура полностью соответствует DRY принципам и готова к расширению!** 🚀
