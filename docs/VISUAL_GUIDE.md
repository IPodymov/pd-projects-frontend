# 🎬 Визуальное руководство

## Как работает система аутентификации (пошагово)

### Шаг 1: Пользователь открывает приложение

```
Браузер                    Backend              LocalStorage
   │                          │                      │
   │──── GET / ────────────────►                      │
   │                          │                      │
   │◄─── index.html ──────────│                      │
   │                          │                      │
   ├─ Vue инициализируется                           │
   │  └─ Загружает состояние ◄─────────────────────┐ │
   │                                              │ │
   │                          authToken: "..."   │ │
   │                          user: {...}        │ │
```

### Шаг 2a: Нет авторизации → Перейти на /login

```
   ┌─────────────────────────────────────┐
   │ Нет токена в localStorage           │
   │ Перенаправить на /login             │
   └─────────────────────────────────────┘
                    │
                    ▼
            ┌─────────────────┐
            │   Login.vue     │
            │                 │
            │ Email: _________ │
            │ Pass:  _________ │
            │ [ Войти ]       │
            └────────┬────────┘
```

### Шаг 3a: Пользователь вводит данные

```
   Браузер                                 Store
      │                                      │
      │ Заполняет форму                     │
      │ Нажимает "Войти"                    │
      │                                      │
      │──── emit('login') ───────────────►  │
      │                                      │
      │                                      │
```

### Шаг 4a: Отправка запроса на backend

```
   Store            API Service               Backend
     │                   │                        │
     │ login()          │                         │
     │──────────────►   │                         │
     │                  │ apiCall()               │
     │                  │──────────────────────► │
     │                  │ POST /auth/login       │
     │                  │ Authorization: Bearer  │
     │                  │                        │
     │                  │ ◄─────────────────────│
     │                  │ { token, user }       │
     │                  │                        │
     │◄─────────────────│                        │
     │ setUser()                                │
     │ setToken()                               │
     │                                          │
```

### Шаг 5a: Успешная авторизация

```
   LocalStorage        Component              Router
       │                   │                     │
       │                   │                     │
   Сохр: token    Login.vue    Перенаправить  /
   Сохр: user         │              │          │
       │              │              │          │
       │◄─────────────│              │          │
       │                             ├─────────►│
       │                             │          │
       │                          Navbar      Dashboard
       │                          Welcome!
```

### Шаг 2b: Есть авторизация → Показать главную

```
   ┌─────────────────────────────────────┐
   │ Есть токен в localStorage           │
   │ Пользователь авторизован            │
   │ Показать navbar с данными           │
   └─────────────────────────────────────┘
                    │
                    ▼
      ┌──────────────────────────────┐
      │       App.vue (navbar)       │
      │                              │
      │ ┌────────────────────────┐   │
      │ │ Привет, Иван Петров!  │   │
      │ │ ivan@example.com       │   │
      │ │ [ Выход ]              │   │
      │ └────────────────────────┘   │
      │                              │
      │ <router-view>                │
      │   [Основное содержимое]      │
      │ </router-view>               │
      └──────────────────────────────┘
```

---

## Поток регистрации (Register.vue)

```
┌──────────────────────────────────────┐
│        Register.vue                  │
│                                      │
│ Name:     ______________________     │
│ Email:    ______________________     │
│ Password: ______________________     │
│ Confirm:  ______________________     │
│                                      │
│ [ Зарегистрироваться ]               │
│                                      │
│ Уже есть аккаунт? Войти              │
└──────────────────┬───────────────────┘
                   │
                   ▼
         ┌─────────────────┐
         │ Валидация       │
         │ ✓ Все поля      │
         │ ✓ Пароли совп.  │
         └────────┬────────┘
                  │
                  ▼
        ┌──────────────────┐
        │ POST /auth/reg   │
        │ { name, email... │
        └────────┬─────────┘
                 │
         ┌───────┴────────┐
         │                │
      Успех           Ошибка
         │                │
         ▼                ▼
    ┌─────────┐      ┌──────────┐
    │ Сохранить│      │ Показать │
    │ токен    │      │ ошибку   │
    │ Сохран.  │      │ красное  │
    │ user     │      │ сообщ.   │
    └────┬────┘      └──────────┘
         │
         ▼
    Перенаправить
    на главную
```

---

## Взаимодействие компонентов

```
┌─────────────────────────────────────────────────────────┐
│                    App.vue                              │
│  ┌──────────────────────────────────────────────────┐   │
│  │               Navbar (если авторизован)          │   │
│  │  Привет, Иван Петров! | [Выход]                │   │
│  └──────────────────────────────────────────────────┘   │
│                                                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │           <router-view>                          │   │
│  │  ┌────────────────────┐  ┌────────────────────┐ │   │
│  │  │   /login           │  │   /register        │ │   │
│  │  │   Login.vue        │  │   Register.vue     │ │   │
│  │  │                    │  │                    │ │   │
│  │  │ Форма входа    ◄──────► Форма регистра    │ │   │
│  │  │                    │  │ (ссылка на вход)   │ │   │
│  │  └────────────────────┘  └────────────────────┘ │   │
│  │         ↓                        ↓               │   │
│  │    useAuth()              useAuth()              │   │
│  │         │                        │               │   │
│  │         └───────────┬────────────┘               │   │
│  │                     ▼                            │   │
│  │            store.js (store)                      │   │
│  │  - state (user, token, error, isLoading)       │   │
│  │  - actions (login, register, logout)           │   │
│  │  - getters (isAuthenticated, user)             │   │
│  │                     │                            │   │
│  │                     ▼                            │   │
│  │        src/services/api.js                       │   │
│  │  - authService (login, register)               │   │
│  │  - userService (profile)                       │   │
│  │  - projectService (projects)                   │   │
│  │  - apiCall() (базовая функция)                │   │
│  │                     │                            │   │
│  │                     ▼                            │   │
│  │       src/config/config.js                      │   │
│  │  - apiBaseUrl (dev/prod)                       │   │
│  │  - endpoints                                   │   │
│  │                     │                            │   │
│  │                     ▼                            │   │
│  │            HTTP запросы                          │   │
│  │       Backend (localhost:3000)                  │   │
│  └──────────────────────────────────────────────────┘   │
│                                                          │
│  └──────────────────────────────────────────────────────┘
│         LocalStorage (authToken, user)
```

---

## Состояние приложения (State Machine)

```
                    ┌──────────────┐
                    │   INITIAL    │
                    │  (загрузка)  │
                    └──────┬───────┘
                           │
                ┌──────────┴──────────┐
                │                     │
                ▼                     ▼
         ┌─────────────┐       ┌──────────────┐
         │ GUEST       │       │ AUTHORIZED   │
         │ (не входил) │       │ (пользователь)
         └──────┬──────┘       └──────┬───────┘
                │                     │
        ┌───────┴────────┐    ┌───────┴────────┐
        │                │    │                │
    /login          /register logout      api запрос
        │                │    │           (401)
        │ успех          │    │                │
        │ ┌──────────────┘    │                │
        │ │                   │                │
        ▼ ▼                   ▼                ▼
    ┌──────────────────────────────────────────┐
    │         AUTHORIZED                       │
    │  - token сохранен                        │
    │  - user сохранен                         │
    │  - localStorage заполнен                 │
    │  - navbar показан                        │
    └──────────────────────────────────────────┘
                        │
                        │
                   /logout
                        │
                        ▼
    ┌──────────────────────────────────────────┐
    │         GUEST                            │
    │  - token удален                          │
    │  - user очищен                           │
    │  - localStorage очищен                   │
    │  - перенаправить на /login               │
    └──────────────────────────────────────────┘
```

---

## Кэширование и хранение данных

```
                    ┌──────────────────┐
                    │   Приложение     │
                    │    (Vue State)   │
                    │                  │
                    │ state.user       │
                    │ state.token      │
                    │ state.isLoading  │
                    │ state.error      │
                    └────────┬─────────┘
                             │
                   ┌─────────┴─────────┐
                   │                   │
                   │ (синхронизирует)  │
                   │                   │
                   ▼                   ▼
            ┌────────────────┐ ┌──────────────────┐
            │ localStorage   │ │ компоненты       │
            │                │ │                  │
            │ authToken:     │ │ Login.vue        │
            │ "jwt..."       │ │ Register.vue     │
            │                │ │ App.vue          │
            │ user:          │ │                  │
            │ {id, name...}  │ │ (отображают)     │
            └────────────────┘ └──────────────────┘
                   │
                   │ (восстанавливает при
                   │  перезагрузке страницы)
                   ▼
            ┌────────────────┐
            │ Browser reload │
            │ F5, ctrl+R     │
            └────────────────┘
```

---

## Сетевой запрос (Network)

```
Браузер                          Backend
   │                                │
   │ 1. OPTIONS (CORS preflight)    │
   │────────────────────────────►   │
   │                                │
   │ 2. 200 OK                      │
   │◄────────────────────────────   │
   │                                │
   │ 3. POST /auth/login            │
   │    Content-Type: application/json
   │    Body: {email, password}     │
   │────────────────────────────►   │
   │                                │
   │ 4. 200 OK                      │
   │    Content-Type: application/json
   │    Body: {token, user}         │
   │◄────────────────────────────   │
   │                                │
   │ 5. GET /projects               │
   │    Authorization: Bearer token │
   │────────────────────────────►   │
   │                                │
   │ 6. 200 OK                      │
   │    Body: [projects...]         │
   │◄────────────────────────────   │
```

---

## Обработка ошибок

```
                    ┌──────────────┐
                    │ HTTP Ошибка  │
                    └──────┬───────┘
                           │
                ┌──────────┼──────────┬──────────┐
                │          │          │          │
                ▼          ▼          ▼          ▼
            ┌─────────┐ ┌──────┐ ┌─────┐ ┌─────┐
            │ 400     │ │401   │ │403  │ │500  │
            │Bad Req │ │Unauth│ │Forbid│ │Error│
            └────┬────┘ └──┬───┘ └──┬──┘ └─┬───┘
                 │         │        │      │
              Показать  Удалить  Показать Пока­
              ошибку    токен    "Нет     зать
              "Неверные переход  доступа" ошибку
              данные"   на /log­           сер­
                        in               вера
                        │
                        ▼
                    ┌──────────────┐
                    │ store.error  │
                    │ показана в UI│
                    └──────────────┘
```

---

## Жизненный цикл компонента

```
Login.vue
─────────────────────────────────────────────────────

    Создание компонента
            │
            ▼
    ┌─────────────────┐
    │ setup()         │
    │ useAuth()       │ ◄─── Получаем методы и состояние
    │ const { login } │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Рендеринг (template) │
    │ Форма с полями  │
    │ Кнопка "Войти"  │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────────────────┐
    │ Пользователь взаимодействует│
    │ - Вводит email              │
    │ - Вводит пароль             │
    │ - Нажимает кнопку           │
    └────────┬────────────────────┘
             │
             ▼
    ┌─────────────────────────────┐
    │ handleLogin() вызывается    │
    │ login(credentials)          │
    │   ▼ (isLoading = true)      │
    │   ▼ HTTP запрос             │
    │   ▼ (isLoading = false)     │
    │   ▼ setUser(user)           │
    │   ▼ setToken(token)         │
    └────────┬────────────────────┘
             │
        ┌────┴─────┐
        │           │
      Успех      Ошибка
        │           │
        ▼           ▼
    Переход    Показать
    на /       ошибку
             
    Компонент остается в памяти
    (в случае ошибки)
             
    Компонент удаляется
    (в случае успеха переход на другую страницу)
```

---

## Типичный день разработчика

```
09:00 Приходу на работу
      ▼
      npm run dev
      ▼
      http://localhost:5173 открывается ✓
      
10:00 Нужна новая форма для профиля
      ▼
      const { user } = useAuth() ✓
      ▼
      Импортирую userService ✓
      ▼
      await userService.updateProfile(...) ✓
      ▼
      Все работает! 🎉
      
11:00 Backend изменил URL
      ▼
      Обновляю src/config/config.js ✓
      ▼
      Все endpoints автоматически обновились! ✓
      
12:00 Нужна новая функция в API
      ▼
      Добавляю метод в src/services/api.js ✓
      ▼
      Используюю в компонентах ✓
      ▼
      Готово в 5 минут! ⚡
      
13:00 Обед
```

---

**Система полностью готова и интуитивна!** 🚀

Смотрите реальные примеры в [EXAMPLES.js](EXAMPLES.js)
