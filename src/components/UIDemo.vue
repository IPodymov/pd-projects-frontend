<template>
  <div class="demo-container">
    <h1>üé® –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h1>
    <p class="description">
      –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏–∑ –ø–∞–ø–∫–∏
      <code>src/components/ui/</code>
    </p>

    <!-- BaseButton –ø—Ä–∏–º–µ—Ä—ã -->
    <section class="demo-section">
      <h2>BaseButton</h2>
      <div class="demo-grid">
        <div>
          <h3>–í–∞—Ä–∏–∞–Ω—Ç—ã —Å—Ç–∏–ª–µ–π</h3>
          <div class="button-row">
            <BaseButton variant="primary">Primary</BaseButton>
            <BaseButton variant="secondary">Secondary</BaseButton>
            <BaseButton variant="accent">Accent</BaseButton>
            <BaseButton variant="danger">Danger</BaseButton>
            <BaseButton variant="ghost">Ghost</BaseButton>
          </div>
        </div>

        <div>
          <h3>–°–æ—Å—Ç–æ—è–Ω–∏—è</h3>
          <div class="button-row">
            <BaseButton :loading="true">–ó–∞–≥—Ä—É–∑–∫–∞...</BaseButton>
            <BaseButton disabled>Disabled</BaseButton>
            <BaseButton @click="showAlert">–° –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º</BaseButton>
          </div>
        </div>
      </div>
    </section>

    <!-- BaseInput –ø—Ä–∏–º–µ—Ä—ã -->
    <section class="demo-section">
      <h2>BaseInput</h2>
      <div class="demo-grid">
        <div>
          <h3>–¢–∏–ø—ã –ø–æ–ª–µ–π</h3>
          <BaseInput
            v-model="demoInputs.text"
            label="–¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ"
            placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç"
          />

          <BaseInput
            v-model="demoInputs.email"
            type="email"
            label="Email"
            placeholder="your@email.com"
          />

          <BaseInput
            v-model="demoInputs.password"
            type="password"
            label="–ü–∞—Ä–æ–ª—å"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
          />
        </div>

        <div>
          <h3>–° –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏</h3>
          <BaseInput
            v-model="demoInputs.required"
            label="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ"
            required
            :error="demoInputs.required ? '' : '–ü–æ–ª–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º'"
          />

          <BaseInput
            v-model="demoInputs.withHint"
            label="–° –ø–æ–¥—Å–∫–∞–∑–∫–æ–π"
            hint="–≠—Ç–æ –ø–æ–ª–µ —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π"
          />

          <BaseInput
            v-model="demoInputs.disabled"
            label="–û—Ç–∫–ª—é—á–µ–Ω–Ω–æ–µ –ø–æ–ª–µ"
            disabled
          />
        </div>
      </div>
    </section>

    <!-- ErrorMessage –ø—Ä–∏–º–µ—Ä—ã -->
    <section class="demo-section">
      <h2>ErrorMessage</h2>
      <div class="demo-grid">
        <div>
          <h3>–° –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç–∏—è</h3>
          <ErrorMessage
            v-if="showError1"
            message="–≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å"
            @close="showError1 = false"
          />
          <BaseButton v-else variant="secondary" @click="showError1 = true">
            –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
          </BaseButton>
        </div>

        <div>
          <h3>–ë–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–∫—Ä—ã—Ç–∏—è</h3>
          <ErrorMessage
            message="–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞! –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å"
            :closable="false"
          />
        </div>
      </div>
    </section>

    <!-- BaseCombobox –ø—Ä–∏–º–µ—Ä—ã -->
    <section class="demo-section">
      <h2>BaseCombobox</h2>
      <div class="demo-grid">
        <div>
          <h3>–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</h3>
          <BaseCombobox
            v-model="selectedCountry"
            label="–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É"
            placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É..."
            :options="countries"
            valueKey="id"
            displayKey="name"
          />
          <p v-if="selectedCountry" class="result">
            ‚úì –í—ã–±—Ä–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ —Å ID: <strong>{{ selectedCountry }}</strong>
          </p>
        </div>

        <div>
          <h3>–° –ø–æ–∏—Å–∫–æ–º</h3>
          <BaseCombobox
            v-model="selectedLanguage"
            label="–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è"
            placeholder="–ù–∞–π–¥–∏—Ç–µ —è–∑—ã–∫..."
            :options="languages"
            valueKey="id"
            displayKey="name"
            searchable
          />
          <p v-if="selectedLanguage" class="result">
            ‚úì –í—ã–±—Ä–∞–Ω —è–∑—ã–∫ —Å ID: <strong>{{ selectedLanguage }}</strong>
          </p>
        </div>

        <div>
          <h3>–ë–µ–∑ –ø–æ–∏—Å–∫–∞</h3>
          <BaseCombobox
            v-model="selectedRole"
            label="–†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
            placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å..."
            :options="roles"
            valueKey="id"
            displayKey="name"
            :searchable="false"
          />
        </div>

        <div>
          <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)</h3>
          <BaseCombobox
            v-model="selectedUserId"
            label="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
            placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è..."
            :fetchOptions="fetchUsers"
            valueKey="id"
            displayKey="name"
          >
            <template #option="{ option }">
              <div class="user-option">
                <strong>{{ option.name }}</strong>
                <br />
                <small>{{ option.email }}</small>
              </div>
            </template>
          </BaseCombobox>
          <p v-if="selectedUserId" class="result">
            ‚úì –í—ã–±—Ä–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID: <strong>{{ selectedUserId }}</strong>
          </p>
        </div>

        <div>
          <h3>–ó–∞–≥—Ä—É–∑–∫–∞ —à–∫–æ–ª –∏–∑ API</h3>
          <BaseCombobox
            v-model="selectedSchoolId"
            label="–í—ã–±–µ—Ä–∏—Ç–µ —à–∫–æ–ª—É"
            placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —à–∫–æ–ª—É..."
            :fetchOptions="fetchSchools"
            valueKey="id"
            displayKey="name"
            hint="–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ API"
          />
          <p v-if="selectedSchoolId" class="result">
            ‚úì –í—ã–±—Ä–∞–Ω–∞ —à–∫–æ–ª–∞ —Å ID: <strong>{{ selectedSchoolId }}</strong>
          </p>
        </div>

        <div>
          <h3>–° –∫–∞—Å—Ç–æ–º–Ω—ã–º —à–∞–±–ª–æ–Ω–æ–º</h3>
          <BaseCombobox
            v-model="selectedProject"
            label="–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç"
            placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç..."
            :options="projects"
            valueKey="id"
            displayKey="title"
          >
            <template #option="{ option }">
              <div class="project-option">
                <strong>{{ option.title }}</strong>
                <br />
                <small>{{ option.description }}</small>
              </div>
            </template>
          </BaseCombobox>
        </div>
      </div>
    </section>

    <!-- –ü–æ–ª–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
    <section class="demo-section">
      <h2>–ü–æ–ª–Ω–∞—è —Ñ–æ—Ä–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π</h2>
      <div class="form-demo">
        <ErrorMessage
          v-if="formError"
          :message="formError"
          @close="formError = ''"
        />

        <BaseInput
          v-model="formData.name"
          label="–ü–æ–ª–Ω–æ–µ –∏–º—è"
          placeholder="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤"
          required
          :error="formErrors.name"
        />

        <BaseInput
          v-model="formData.email"
          type="email"
          label="Email"
          placeholder="your@email.com"
          required
          :error="formErrors.email"
        />

        <BaseCombobox
          v-model="formData.role"
          label="–†–æ–ª—å"
          placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å..."
          :options="roles"
          valueKey="id"
          displayKey="name"
          required
          :error="formErrors.role"
        />

        <BaseCombobox
          v-model="formData.country"
          label="–°—Ç—Ä–∞–Ω–∞"
          placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É..."
          :options="countries"
          valueKey="id"
          displayKey="name"
        />

        <div class="button-row">
          <BaseButton
            variant="primary"
            :loading="isSubmitting"
            @click="submitForm"
          >
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É
          </BaseButton>
          <BaseButton variant="secondary" @click="resetForm">
            –°–±—Ä–æ—Å–∏—Ç—å
          </BaseButton>
        </div>
      </div>
    </section>
  </div>
</template>

<script setup>
import { ref, computed } from "vue";
import { BaseButton, BaseInput, BaseCombobox, ErrorMessage } from "./ui";
import { userService, schoolService } from "../services/api";

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è BaseInput
const demoInputs = ref({
  text: "",
  email: "",
  password: "",
  required: "",
  withHint: "",
  disabled: "–≠—Ç–æ –ø–æ–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ",
});

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è ErrorMessage
const showError1 = ref(true);

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è BaseCombobox - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
const selectedCountry = ref(null);
const selectedLanguage = ref(null);
const selectedRole = ref(null);
const selectedProject = ref(null);

const countries = [
  { id: 1, name: "–†–æ—Å—Å–∏—è" },
  { id: 2, name: "–°–®–ê" },
  { id: 3, name: "–ì–µ—Ä–º–∞–Ω–∏—è" },
  { id: 4, name: "–§—Ä–∞–Ω—Ü–∏—è" },
  { id: 5, name: "–ò—Ç–∞–ª–∏—è" },
];

const languages = [
  { id: "js", name: "JavaScript" },
  { id: "py", name: "Python" },
  { id: "java", name: "Java" },
  { id: "cpp", name: "C++" },
  { id: "go", name: "Go" },
  { id: "rust", name: "Rust" },
  { id: "php", name: "PHP" },
  { id: "ruby", name: "Ruby" },
];

const roles = [
  { id: "admin", name: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä" },
  { id: "teacher", name: "–£—á–∏—Ç–µ–ª—å" },
  { id: "student", name: "–£—á–µ–Ω–∏–∫" },
];

const projects = [
  { id: 1, title: "–ü—Ä–æ–µ–∫—Ç Alpha", description: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è" },
  { id: 2, title: "–ü—Ä–æ–µ–∫—Ç Beta", description: "–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" },
  { id: 3, title: "–ü—Ä–æ–µ–∫—Ç Gamma", description: "–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è" },
];

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è BaseCombobox - API –∑–∞–≥—Ä—É–∑–∫–∞
const selectedUserId = ref(null);
const selectedSchoolId = ref(null);

const fetchUsers = async () => {
  try {
    const response = await userService.searchUsers("");
    return response.users || [];
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:", error);
    return [];
  }
};

const fetchSchools = async () => {
  try {
    return await schoolService.getAllSchools();
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∫–æ–ª:", error);
    return [];
  }
};

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ–π —Ñ–æ—Ä–º—ã
const formData = ref({
  name: "",
  email: "",
  role: null,
  country: null,
});

const formError = ref("");
const isSubmitting = ref(false);

const formErrors = computed(() => {
  const errors = {};

  if (!formData.value.name) {
    errors.name = "–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ";
  }

  if (!formData.value.email) {
    errors.email = "Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω";
  } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(formData.value.email)) {
    errors.email = "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email";
  }

  if (!formData.value.role) {
    errors.role = "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å";
  }

  return errors;
});

const submitForm = async () => {
  formError.value = "";

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  if (Object.keys(formErrors.value).length > 0) {
    formError.value = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ";
    return;
  }

  isSubmitting.value = true;

  // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏
  try {
    await new Promise((resolve) => setTimeout(resolve, 2000));
    alert(
      "–§–æ—Ä–º–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!\n\n" + JSON.stringify(formData.value, null, 2)
    );
    resetForm();
  } catch (error) {
    formError.value = "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã";
  } finally {
    isSubmitting.value = false;
  }
};

const resetForm = () => {
  formData.value = {
    name: "",
    email: "",
    role: null,
    country: null,
  };
  formError.value = "";
};

const showAlert = () => {
  alert("–ö–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞!");
};
</script>

<style scoped>
.demo-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 40px 20px;
}

h1 {
  color: var(--color-primary);
  margin-bottom: 10px;
}

.description {
  color: #666;
  margin-bottom: 40px;
}

code {
  background-color: var(--color-light-gray);
  padding: 2px 6px;
  border-radius: 4px;
  font-family: "Monaco", "Courier New", monospace;
  font-size: 14px;
}

.demo-section {
  margin-bottom: 50px;
  padding: 30px;
  background: var(--color-background);
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.demo-section h2 {
  color: var(--color-text);
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid var(--color-primary);
}

.demo-section h3 {
  color: var(--color-text);
  font-size: 16px;
  margin-bottom: 15px;
}

.demo-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 30px;
}

.button-row {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
}

.result {
  margin-top: 10px;
  padding: 10px;
  background-color: #e8f5e9;
  border-left: 3px solid var(--color-success);
  border-radius: 4px;
  color: var(--color-text);
  font-size: 14px;
}

.user-option,
.project-option {
  padding: 4px 0;
}

.user-option small,
.project-option small {
  color: #999;
}

.form-demo {
  max-width: 500px;
  margin: 0 auto;
}
</style>
